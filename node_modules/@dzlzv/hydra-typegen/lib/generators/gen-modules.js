"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.buildModuleProps = exports.generateModuleTypes = void 0;
const tslib_1 = require("tslib");
const util_1 = require("../util");
const path_1 = tslib_1.__importDefault(require("path"));
const imports_1 = require("./imports");
const helpers_1 = require("./helpers");
const lodash_1 = require("lodash");
const debug = require('debug')('hydra-typegen:gen-modules');
const generateModuleTemplate = helpers_1.handlebars.compile(util_1.readTemplate('module'));
function generateModuleTypes(config) {
    const { modules, dest } = config;
    modules.forEach((meta) => {
        const { module } = meta;
        const props = buildModuleProps(meta, config);
        util_1.writeFile(path_1.default.join(dest, `${lodash_1.kebabCase(module.name.toString())}.ts`), () => util_1.formatWithPrettier(generateModuleTemplate(props)));
    });
    debug('Done writing event types');
}
exports.generateModuleTypes = generateModuleTypes;
function buildModuleProps(meta, config) {
    const { validateArgs } = config;
    const imports = imports_1.buildModuleImports(meta, config);
    debug(`Imports: ${JSON.stringify(imports, null, 2)}`);
    return Object.assign({ validateArgs,
        imports }, meta);
}
exports.buildModuleProps = buildModuleProps;
