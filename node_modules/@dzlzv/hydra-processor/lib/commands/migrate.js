"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const command_1 = require("@oclif/command");
const db_1 = require("../db");
const log_1 = require("../util/log");
const dotenv_1 = tslib_1.__importDefault(require("dotenv"));
class Migrate extends command_1.Command {
    async run() {
        let connection;
        log_1.info('Running migrations for Hydra Processor');
        const { flags } = this.parse(Migrate);
        if (flags.env) {
            dotenv_1.default.config({ path: flags.env });
        }
        try {
            connection = await db_1.createDBConnection();
            if (connection)
                await connection.runMigrations();
            log_1.info('Hydra Processor migrations completed successfully');
        }
        finally {
            if (connection)
                await connection.close();
        }
    }
}
exports.default = Migrate;
Migrate.flags = {
    env: command_1.flags.string({
        char: 'e',
        description: 'Path to a file with environment variables',
    }),
};
//# sourceMappingURL=migrate.js.map